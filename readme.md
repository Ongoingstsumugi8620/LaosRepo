# 总览
## 使用说明
### 用前提醒
1. 请确保您已安装pandas, numpy, matpolitlib, tkinter 和 mplfinance 库。否则程序无法正常启动。
### config页
1. 用家可随数据范围调整默认起始时间和终止时间，用家也可自行调控n日回测默认的n和与之比较的平均值日数。方便可读数据增大时的默认设置更改。
### 开始页面
1. 按下返回键可以回到开始页面
2. 按下不同按钮可以进入相应页面
3. 按下Exit 按钮并确认可以退出程序
### 回测页面
1. 回测页面可以输入想要的参数，默认设置在输入界面上方。起始资金默认为100000
2. 如果stock ID输入了不在股票内的字符，将会弹出报错
3. 开始日期不能比2022-12-30（config内默认设置）晚，结束日期不能比2020-01-02（config内默认设置）早，开始日期必须早于结束日期。
4. 如果输入后没有图片生成，请检查日期输入格式是否正确（YYYY-MM-DD），Look back Period 和 Decline Days应该输入正整数。
5. 如果NAV没有变化，请检查deccline days输入数值是否太大或比Lookback period更大。
6. 该界面下，点击Run backtest 或按下Enter键将进行回测
#### 结果展示
1. 在介面外彈出的圖片中會展示該策略的超额收益，年化收益，年化波动，夏普比率，最大回撤。
### K线图生成页面
1. 同回测页面输入股票id，开始和结束日期生成K线图
2. 该界面下，点击Load K-Line Data或按下Enter键将生成k线图
#### 说明
1. 蜡烛的实体部分（较厚的部分）表示开盘价和收盘价之间的区间。
- 实体上下的细线（影线）显示了当天的最高价和最低价。

另外，图中包含三条移动平均线，代表不同时间周期的平均收盘价：

- 红色线代表3日移动平均值。
- 蓝色线代表6日移动平均值。
- 黄色线代表9日移动平均值。

移动平均线帮助我们识别价格趋势和潜在的支持/阻力水平。

### 均值回归策略与布林带
#### 策略逻辑
均值回归策略基于价格最终将回归至平均水平的假设。该策略采用布林带作为参考，布林带是放置在移动平均线上下的波动率带。

##### 默认设置
- `lookback_period`: 20（用于计算移动平均和标准差的默认回望期）
- `decline_days`: 5（连续下跌天数超过此值时触发买入信号）
- `num_std_dev`: 2（布林带距离平均值的标准差倍数）

#### 买入和卖出逻辑
- **Buy Signal**：当价格连续下跌天数大于 `decline_days` 并且当前最低价低于下布林带时，产生买入信号。
- **Sell Signal**：当当前最高价高于上布林带时，产生卖出信号。

### 交易过程
交易过程包括根据生成的信号执行买入和卖出订单：

- **Buy**：如果出现 buy signal 且有足够的资金，则以 'low' 价格购买股票。
- **Sell**：如果出现 sell signal 且当前持有股票，则以 'high' 价格卖出所有股票。

组合价值是基于 'close' 价格计算的，它代表了每个交易日结束时的组合价值。

### 指标计算

计算以下指标以评估策略的表现：

- **最终资本Final Capital**：回测期结束时的总资本，包括任何仍持有的股份的价值。
- **最大回撤Maximum Drawdown**：组合价值从峰到谷的最大下降。计算公式为 `min(df['NAV'] / df['NAV'].cummax() - 1)`。
- **夏普比率Sharpe Ratio**：风险调整后的收益率。计算公式为 `(mean(daily_returns - risk_free_rate / 252)) / std(daily_returns) * sqrt(252)`。
- **超额收益Excess Earnings**：策略收益超过无风险利率的部分。计算公式为 `(sum(daily_returns) - risk_free_rate / 252 * total_days) * initial_capital`。
- **年化收益率Annualized Rate of Return**：组合的复合年增长率。计算公式为 `((df['Portfolio Value'].iloc[-1] / initial_capital) ** (252 / total_days)) - 1`。
- **年化波动率Annualized Volatility**：日收益率的标准差，年化计算。计算公式为 `std(daily_returns) * sqrt(252)`。

### K线图生成说明
1. 使用mplfinance 库函数来生成K线图